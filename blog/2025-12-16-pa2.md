---
slug: PA2
title: PA2 note
authors: [zephyr]
tags: [pl,nemu]
---

## Instruction Cycle

Fetch-decode-execute cycle or fetch-execute cycle from CPU boots-up to shut down.
Program Counter (PC) is a register  that holds the memory address of the
next instruction to be executed.

## Decode

INSTPAT_INST differs from ISA, in risc-v it points to
`#define INSTPAT_INST(s) ((s)->isa.inst)`

Parameters are: Pattern string, inst name, inst type, inst operation.

```c
#define INSTPAT(pattern, ...) do { \
  uint64_t key, mask, shift; \
  pattern_decode(pattern, STRLEN(pattern), &key, &mask, &shift); \
  if ((((uint64_t)INSTPAT_INST(s) >> shift) & mask) == key) { \
    INSTPAT_MATCH(s, ##__VA_ARGS__); \
    goto *(__instpat_end); \
  } \
} while (0)


```

`&` in C is bitwise AND operator.
