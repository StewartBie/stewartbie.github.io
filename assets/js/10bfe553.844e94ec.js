"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[2606],{2643:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>a});var l=i(7849),r=i(4848),t=i(8453);const s={slug:"Make",title:"How To Write a Good Makefile",authors:["zephyr"],tags:["nemu"]},d=void 0,c={authorsImageUrls:[void 0]},a=[{value:"Variable",id:"variable",level:2},{value:"Wildcard",id:"wildcard",level:3},{value:"shell",id:"shell",level:3},{value:"include",id:"include",level:3},{value:"EG",id:"eg",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"variable",children:"Variable"}),"\n",(0,r.jsxs)(n.p,{children:["Make can read Variables from the ",(0,r.jsx)(n.a,{href:"https://stackoverflow.com/questions/39036774/advanced-variable-inheritance-in-gnu-make",children:"Environment"}),"\ndefine Variables ",(0,r.jsx)(n.code,{children:"SRC = main.c utils.c"})," then use ",(0,r.jsx)(n.code,{children:"$(SRC)"})," rather than ",(0,r.jsx)(n.code,{children:"$SRC"}),".\nOnly the single alphabet variables can use ",(0,r.jsx)(n.code,{children:"$S"})," without ",(0,r.jsx)(n.code,{children:"()"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"addons"}),"  use ",(0,r.jsx)(n.code,{children:"SRC += extra.c"}),"\nCommonly used auto variables:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"code"}),(0,r.jsx)(n.th,{children:"meaning"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$@"})}),(0,r.jsx)(n.td,{children:"current target"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$<"})}),(0,r.jsx)(n.td,{children:"current first dependency"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$^"})}),(0,r.jsx)(n.td,{children:"all dependency (auto remove repeated files)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"$?"})}),(0,r.jsx)(n.td,{children:"dependencies whose time stamp newer than target"})]})]})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Makefile",children:"%.o: %.c\n  $(CC) -c $< -o $@\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wildcard",children:"Wildcard"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Make",children:"$(wildcard PATTERN)\nSRC := $(wildcard *.c)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["What's more ",(0,r.jsx)(n.code,{children:"**/*.c"})," is not supported in Makefile.\nTo realize this effect we can use ",(0,r.jsx)(n.code,{children:"shell"}),"\n",(0,r.jsx)(n.code,{children:'SRC := $(shell find src -name "*.c")'})]}),"\n",(0,r.jsx)(n.h3,{id:"shell",children:"shell"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"="})," and ",(0,r.jsx)(n.code,{children:":="})," will lead to different result and have influence on performance."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Makefile",children:"# This will run everytime when using $(FILES)\nFILES = $(shell ls) \n\n# this will run only the first time\nFILES := $(shell ls) \n"})}),"\n",(0,r.jsx)(n.h3,{id:"include",children:"include"}),"\n",(0,r.jsx)(n.p,{children:"Simple COPY-PASTE , same as include in C."}),"\n",(0,r.jsx)(n.h2,{id:"eg",children:"EG"}),"\n",(0,r.jsxs)(n.p,{children:["The code below is to check whether ",(0,r.jsx)(n.code,{children:"$(NEMU_HOME)/src/nemu-main.c"})," exists.\nIf it doesn't exist, ",(0,r.jsx)(n.code,{children:"wildcard"})," will return a null string.\nAnd  tow null strings equal, it will throw an error."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Make",children:"ifeq ($(wildcard $(NEMU_HOME)/src/nemu-main.c),)\n  $(error NEMU_HOME=$(NEMU_HOME) is not a NEMU repo)\nendif\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"include files"})," If I use ",(0,r.jsx)(n.code,{children:"include some/files"})," the relative path depends on\nwhere we run ",(0,r.jsx)(n.code,{children:"make run"}),", in other word the 'root Makefile'"]}),"\n",(0,r.jsxs)(n.p,{children:["The Eg below , in the child Makefile finds a ",(0,r.jsx)(n.code,{children:".config"})," file, actually Make will\nfind this file in the directory where there is a Makefile who includes this"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Make",children:"ifeq ($(wildcard .config),)\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},7849:e=>{e.exports=JSON.parse('{"permalink":"/blog/Make","editUrl":"github.com/StewartBie/stewartbie.github.io/blog/blog/2025-12-11-make.md","source":"@site/blog/2025-12-11-make.md","title":"How To Write a Good Makefile","description":"Variable","date":"2025-12-11T00:00:00.000Z","tags":[{"inline":false,"label":"Nemu","permalink":"/blog/tags/nemu","description":"works about nemu"}],"readingTime":1.24,"hasTruncateMarker":false,"authors":[{"name":"Stewart Bie","title":"student","page":{"permalink":"/blog/authors/all-zephyr-articles"},"socials":{"github":"https://github.com/StewartBie"},"key":"zephyr"}],"frontMatter":{"slug":"Make","title":"How To Write a Good Makefile","authors":["zephyr"],"tags":["nemu"]},"unlisted":false,"prevItem":{"title":"Architecture","permalink":"/blog/Architecture"},"nextItem":{"title":"Thought About Linked List","permalink":"/blog/linked-list"}}')},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var l=i(6540);const r={},t=l.createContext(r);function s(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);